# THIS CONFIG IS FOR USE WITH Octopus 1.1, Beacon & EBB36

# Required Configs, Always include these
[include mainsail.cfg]
[include macros/*.cfg]
[include timelapse.cfg]
[include K-ShakeTune/*.cfg]

#####################################################################
#   MCU / Octopus / EBB36
#####################################################################

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_25002D000150335331383520-if00
#serial: platform-fd500000.pcie-pci-0000:01:00.0-usb-0:1.3:1.0
restart_method: command

[mcu EBB36]
canbus_uuid: d03347641955

[temperature_sensor Octopus]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBB36
min_temp: 0
max_temp: 100

[temperature_sensor RPi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100


#####################################################################
#   Machine
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 5.0

[idle_timeout]
timeout: 1800


#####################################################################
#   X/Y Stepper Settings
#####################################################################

[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 40
homing_retract_dist: 0

[tmc2209 stepper_x]
uart_pin: PC4
diag_pin: ^PG6
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 0
driver_SGTHRS: 140

[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 40
homing_retract_dist: 0

[tmc2209 stepper_y]
uart_pin: PD11
diag_pin: ^PG9
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 0
driver_SGTHRS: 140


#####################################################################
#   Z Stepper Settings
#####################################################################

[stepper_z]
step_pin: PF11
dir_pin: !PG3
enable_pin: !PG5
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: probe:z_virtual_endstop
position_max: 290
position_min: -2.5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0


[tmc2209 stepper_z]
uart_pin: PC6
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z2]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBB36:PD0
dir_pin: !EBB36:PD1
enable_pin: !EBB36:PD2
rotation_distance: 22.50
gear_ratio: 50:8
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBB36:PB13
sensor_type: PT1000
pullup_resistor: 2200
sensor_pin: EBB36:PA3
min_temp: 10
max_temp: 350
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 500
max_extrude_cross_section: 5.0
pressure_advance: 0.02
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: EBB36:PA15
interpolate: false
run_current: 0.60
sense_resistor: 0.110
stealthchop_threshold: 0

[firmware_retraction]
retract_length: 0.5
retract_speed: 35
unretract_extra_length: 0.0
unretract_speed: 35


#####################################################################
#   ADXL / Input Shaper
#####################################################################

[resonance_tester]
accel_chip: beacon
accel_per_hz: 100
probe_points: 150, 150, 20

[adxl345]
cs_pin: EBB36:PB12
spi_software_sclk_pin: EBB36:PB10
spi_software_mosi_pin: EBB36:PB11
spi_software_miso_pin: EBB36:PB2
axes_map: x,y,z

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 76.0
damping_ratio_x = 0.036
shaper_type_y = mzv
shaper_freq_y = 46.5
damping_ratio_y = 0.050


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PA2
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
max_power: 1
pwm_cycle_time: 0.0166
min_temp: 0
max_temp: 120


#####################################################################
#   Beacon
#####################################################################

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_2A25C8345154364134202020FF143F31-if00
x_offset: 0
y_offset: 22
mesh_main_direction: x
mesh_runs: 2


#####################################################################
#   Bed Mesh
#####################################################################

[bed_mesh]
speed: 450
mesh_min: 30,30
mesh_max: 270,270
probe_count: 25,25
algorithm: bicubic


#####################################################################
#   Z-Tilt
#####################################################################

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 8
   150, 258
   270, 8
speed: 450
retries: 10
retry_tolerance: 0.004
horizontal_move_z: 10


#####################################################################
#   Fan Control
#####################################################################

[fan]
pin: EBB36:PA0
kick_start_time: 0.5
off_below: 0.10

[heater_fan hotend_fan]
pin: EBB36:PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[controller_fan Controller_Fan]
pin: PD12
kick_start_time: 0.5
fan_speed: 0.50
idle_timeout: 1800


#####################################################################
# 	Chamber Thermistor
#####################################################################

[temperature_sensor Chamber]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5
min_temp: 0
max_temp: 100
gcode_id: chamber_th

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.606
#*# pid_ki = 1.164
#*# pid_kd = 91.181
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.636
#*# pid_ki = 4.376
#*# pid_kd = 246.136
#*#
#*# [beacon model default]
#*# model_coef = 1.4224131212906368,
#*# 	  1.760719564188449,
#*# 	  0.7911225972478116,
#*# 	  0.36898690428732855,
#*# 	  0.4102733854437782,
#*# 	  0.5147817459642499,
#*# 	  -0.2234086581135876,
#*# 	  -0.5490160428371165,
#*# 	  0.19906423572651866,
#*# 	  0.30632251599727406
#*# model_domain = 1.7921810629123274e-07,1.928696912017407e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 26.977205
#*# model_offset = 0.10900
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.024930, 0.024162, 0.028702, 0.025961, 0.019619, 0.018131, 0.015105, 0.017442, 0.021310, 0.028476, 0.022844, 0.008874, 0.014469, 0.013123, 0.029563, 0.039167, 0.043234, 0.046943, 0.044474, 0.044973, 0.046502, 0.041386, 0.038855, 0.035457, 0.021075
#*# 	  0.022473, 0.023458, 0.027234, 0.020932, 0.013093, 0.010787, 0.008651, 0.011215, 0.016606, 0.022868, 0.013735, 0.003126, 0.008106, 0.011946, 0.023518, 0.033726, 0.038839, 0.043571, 0.040526, 0.041245, 0.042117, 0.039039, 0.035810, 0.032552, 0.022380
#*# 	  0.017773, 0.016293, 0.020840, 0.011081, 0.002583, -0.000090, -0.002798, 0.000744, 0.003692, 0.012067, 0.005582, -0.007892, -0.003507, 0.000659, 0.013662, 0.025196, 0.028795, 0.034210, 0.035777, 0.033493, 0.034541, 0.027003, 0.026099, 0.024300, 0.017895
#*# 	  0.012581, 0.007544, 0.014004, 0.002812, -0.008235, -0.010829, -0.013797, -0.008551, -0.003281, 0.004721, -0.002741, -0.019127, -0.016273, -0.012260, 0.004632, 0.017953, 0.021321, 0.027063, 0.026635, 0.028263, 0.028615, 0.024355, 0.020369, 0.017188, 0.009964
#*# 	  0.004473, -0.001237, 0.010400, -0.003803, -0.012943, -0.019785, -0.021875, -0.018842, -0.011600, -0.003994, -0.015037, -0.035143, -0.035418, -0.029636, -0.007374, 0.010933, 0.011482, 0.020000, 0.018161, 0.020472, 0.022706, 0.020082, 0.014794, 0.010985, 0.004292
#*# 	  -0.002696, -0.006962, 0.007313, -0.005547, -0.017204, -0.022767, -0.026654, -0.024144, -0.017214, -0.010672, -0.023343, -0.046152, -0.046895, -0.040605, -0.017087, 0.002657, 0.006805, 0.012271, 0.010867, 0.014383, 0.016364, 0.014964, 0.011950, 0.006070, -0.000151
#*# 	  -0.004941, -0.009844, 0.003083, -0.006767, -0.015367, -0.021764, -0.026653, -0.025865, -0.019313, -0.012738, -0.023956, -0.044241, -0.044267, -0.038042, -0.017505, 0.000527, 0.002229, 0.006212, 0.005046, 0.008815, 0.013629, 0.012764, 0.010449, 0.004659, -0.000777
#*# 	  -0.004463, -0.009397, -0.002587, -0.004581, -0.010797, -0.016321, -0.020777, -0.020734, -0.016345, -0.009113, -0.015187, -0.030474, -0.026987, -0.023713, -0.009227, 0.001269, 0.003060, 0.006743, 0.005832, 0.010595, 0.015497, 0.014506, 0.013194, 0.009399, 0.003868
#*# 	  0.000209, -0.007940, -0.002192, -0.002219, -0.007639, -0.011208, -0.016356, -0.016282, -0.011686, -0.004160, -0.009301, -0.018508, -0.014927, -0.012542, -0.004866, 0.002582, 0.004399, 0.006315, 0.005782, 0.012763, 0.017321, 0.016632, 0.014184, 0.010511, 0.006216
#*# 	  0.000137, -0.005396, -0.002306, -0.002901, -0.008368, -0.012273, -0.017848, -0.017115, -0.012598, -0.004404, -0.007358, -0.016482, -0.011515, -0.009977, -0.004008, 0.003067, 0.002323, 0.004085, 0.003014, 0.009470, 0.016038, 0.015948, 0.013237, 0.009590, 0.007663
#*# 	  0.001969, -0.003153, -0.000596, -0.000393, -0.009021, -0.014074, -0.019844, -0.019381, -0.013426, -0.004763, -0.006136, -0.014855, -0.010016, -0.009292, -0.001311, 0.003019, 0.001885, 0.001977, 0.001570, 0.006886, 0.015115, 0.013430, 0.010907, 0.007934, 0.013043
#*# 	  0.004204, -0.003497, 0.005428, 0.002395, -0.005053, -0.011674, -0.016513, -0.017465, -0.011847, -0.002349, -0.003128, -0.010924, -0.005310, -0.004545, 0.002050, 0.005929, 0.005187, 0.004746, 0.003910, 0.010150, 0.017185, 0.016407, 0.013014, 0.012098, 0.020408
#*# 	  0.018037, 0.013236, 0.017027, 0.014075, 0.006012, 0.000763, -0.004384, -0.005494, -0.001048, 0.007708, 0.006804, -0.000517, 0.003169, 0.006353, 0.011228, 0.014662, 0.013389, 0.012617, 0.012074, 0.018692, 0.024515, 0.023836, 0.021826, 0.022287, 0.027950
#*# 	  0.023817, 0.016165, 0.021889, 0.018649, 0.009753, 0.004164, -0.000111, 0.000087, 0.002782, 0.010388, 0.009070, 0.000742, 0.006937, 0.009027, 0.013659, 0.015740, 0.014289, 0.015368, 0.014017, 0.018189, 0.024101, 0.022422, 0.020729, 0.028926, 0.026267
#*# 	  0.023682, 0.016038, 0.019971, 0.017080, 0.007475, 0.001078, -0.003858, -0.004123, 0.000738, 0.007551, 0.004576, -0.004272, 0.001482, 0.003117, 0.007799, 0.010861, 0.009602, 0.009566, 0.007719, 0.010446, 0.017013, 0.014522, 0.011360, 0.014122, 0.015500
#*# 	  0.018332, 0.009786, 0.012614, 0.011392, 0.001097, -0.006467, -0.010364, -0.011758, -0.007276, -0.001222, -0.004680, -0.014442, -0.009623, -0.007636, -0.003097, 0.001596, 0.000854, 0.000180, -0.002112, 0.002915, 0.006221, 0.004390, -0.000007, -0.000785, -0.001622
#*# 	  0.014181, 0.003267, 0.007076, 0.003819, -0.004461, -0.011693, -0.018640, -0.017776, -0.014661, -0.008478, -0.012409, -0.023121, -0.018761, -0.018001, -0.011990, -0.005864, -0.006647, -0.006303, -0.009197, -0.005207, 0.000043, -0.003856, -0.008759, -0.011399, -0.016792
#*# 	  0.009216, -0.001358, 0.000090, -0.000421, -0.009186, -0.014455, -0.020075, -0.021787, -0.018333, -0.012492, -0.016596, -0.026788, -0.024248, -0.022591, -0.017023, -0.011421, -0.010908, -0.010775, -0.012793, -0.007682, -0.004254, -0.007134, -0.013201, -0.017674, -0.022172
#*# 	  0.007486, -0.003466, -0.000481, -0.002010, -0.008162, -0.013273, -0.019613, -0.020291, -0.018692, -0.013056, -0.017335, -0.026946, -0.024197, -0.023527, -0.017904, -0.012596, -0.012677, -0.011235, -0.014912, -0.009964, -0.006254, -0.009158, -0.014536, -0.019208, -0.024713
#*# 	  0.005180, -0.004677, -0.003071, -0.002602, -0.009472, -0.015624, -0.021325, -0.022911, -0.021969, -0.017501, -0.020938, -0.030227, -0.027532, -0.026490, -0.023330, -0.017230, -0.017677, -0.016485, -0.018909, -0.016035, -0.011088, -0.015428, -0.020288, -0.023156, -0.029045
#*# 	  0.002736, -0.007709, -0.003807, -0.007463, -0.011955, -0.018193, -0.023953, -0.028075, -0.028265, -0.024626, -0.028359, -0.038451, -0.034534, -0.036534, -0.031309, -0.027506, -0.026196, -0.025790, -0.030748, -0.025148, -0.022146, -0.025185, -0.032977, -0.035959, -0.041067
#*# 	  0.002814, -0.007170, -0.005890, -0.005805, -0.012436, -0.018967, -0.026885, -0.030261, -0.030556, -0.028592, -0.033043, -0.042523, -0.038746, -0.037972, -0.034228, -0.029345, -0.028182, -0.027967, -0.031236, -0.029965, -0.025335, -0.030984, -0.038157, -0.045867, -0.047269
#*# 	  0.010910, 0.000329, 0.003598, 0.003213, -0.004076, -0.011700, -0.019777, -0.025643, -0.027665, -0.024660, -0.028139, -0.038414, -0.033389, -0.033240, -0.029552, -0.025189, -0.023898, -0.024227, -0.028859, -0.028120, -0.024739, -0.028697, -0.034216, -0.038545, -0.045256
#*# 	  0.021613, 0.012482, 0.015273, 0.014147, 0.005949, -0.002467, -0.012980, -0.016825, -0.019013, -0.015735, -0.018994, -0.029201, -0.022835, -0.025389, -0.024786, -0.023757, -0.020448, -0.020554, -0.024154, -0.022720, -0.019843, -0.022956, -0.029341, -0.033896, -0.042252
#*# 	  0.043896, 0.033849, 0.038090, 0.035839, 0.025158, 0.015752, 0.006516, 0.001722, -0.001170, 0.002769, -0.000522, -0.012484, -0.006411, -0.011272, -0.014250, -0.011620, -0.012265, -0.012871, -0.018482, -0.015991, -0.010903, -0.015395, -0.020031, -0.027397, -0.033848
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 270.0
