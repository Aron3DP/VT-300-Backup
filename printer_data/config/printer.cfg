# THIS CONFIG IS FOR USE WITH Leviathan, Beacon & EBB36

# Required Configs, Always include these
[include mainsail.cfg]
[include macros/*.cfg]
[include timelapse.cfg]
[include K-ShakeTune/*.cfg]

#####################################################################
#   MCU / Leviathan / EBB36
#####################################################################

[mcu]
canbus_uuid: 96476c0cc178

[mcu EBB36]
canbus_uuid: d03347641955

[temperature_sensor Leviathan]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBB36
min_temp: 0
max_temp: 100

[temperature_sensor RPi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100


#####################################################################
#   Machine
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 5.0

[idle_timeout]
timeout: 1800


#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to HV STEPPER 0
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0


#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
[stepper_z]
step_pin: PD4
dir_pin: PD3
enable_pin: !PD7
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: probe:z_virtual_endstop
position_max: 290
position_min: -2.5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0


[tmc2209 stepper_z]
uart_pin: PD5
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: PC11
enable_pin: !PD2
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: PD0
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: PC8
enable_pin: !PC10
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PA8
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBB36:PD0
dir_pin: !EBB36:PD1
enable_pin: !EBB36:PD2
rotation_distance: 22.50
gear_ratio: 50:8
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBB36:PB13
sensor_type: PT1000
pullup_resistor: 2200
sensor_pin: EBB36:PA3
min_temp: 10
max_temp: 350
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 500
max_extrude_cross_section: 5.0
pressure_advance: 0.02
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: EBB36:PA15
interpolate: false
run_current: 0.60
sense_resistor: 0.110
stealthchop_threshold: 0

[firmware_retraction]
retract_length: 0.5
retract_speed: 35
unretract_extra_length: 0.0
unretract_speed: 35


#####################################################################
#   ADXL / Input Shaper
#####################################################################

[resonance_tester]
accel_chip: beacon
accel_per_hz: 75
probe_points: 150, 150, 20

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 76.8
shaper_type_y = mzv
shaper_freq_y = 47.8


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PG11
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA1
pullup_resistor: 2200
max_power: 1
pwm_cycle_time: 0.0166
min_temp: 0
max_temp: 130


#####################################################################
#   Beacon
#####################################################################

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_2A25C8345154364134202020FF143F31-if00
x_offset: 0
y_offset: 22
mesh_main_direction: x
mesh_runs: 2


#####################################################################
#   Bed Mesh
#####################################################################

[bed_mesh]
speed: 450
mesh_min: 30,30
mesh_max: 270,270
probe_count: 25,25
algorithm: bicubic


#####################################################################
#   Z-Tilt
#####################################################################

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 12.5
   150, 252.5
   270, 12.5
speed: 450
retries: 10
retry_tolerance: 0.004
horizontal_move_z: 10


#####################################################################
#   Fan Control
#####################################################################

[fan]
pin: EBB36:PA0
kick_start_time: 0.5
off_below: 0.10

[heater_fan hotend_fan]
pin: EBB36:PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[controller_fan Controller_Fan]
pin: PF9
kick_start_time: 0.5
fan_speed: 0.50
idle_timeout: 1800


#####################################################################
# 	Chamber Thermistor
#####################################################################

[temperature_sensor Chamber]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA2
pullup_resistor: 2200
min_temp: 0
max_temp: 100
gcode_id: chamber_th


#####################################################################
# EXP1 / EXP2 (display) pins
#####################################################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.606
#*# pid_ki = 1.164
#*# pid_kd = 91.181
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.636
#*# pid_ki = 4.376
#*# pid_kd = 246.136
#*#
#*# [beacon model default]
#*# model_coef = 1.4224131212906368,
#*# 	  1.760719564188449,
#*# 	  0.7911225972478116,
#*# 	  0.36898690428732855,
#*# 	  0.4102733854437782,
#*# 	  0.5147817459642499,
#*# 	  -0.2234086581135876,
#*# 	  -0.5490160428371165,
#*# 	  0.19906423572651866,
#*# 	  0.30632251599727406
#*# model_domain = 1.7921810629123274e-07,1.928696912017407e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 26.977205
#*# model_offset = 0.04600
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.013502, -0.018126, -0.022411, -0.029785, -0.031899, -0.029705, -0.033922, -0.034996, -0.029096, -0.021665, -0.020680, -0.027188, -0.021417, -0.013231, -0.012664, -0.004772, -0.002544, -0.003348, -0.007221, -0.007836, -0.010018, -0.008944, 0.003277, -0.003922, -0.014153
#*# 	  -0.015605, -0.019056, -0.023995, -0.032556, -0.035294, -0.034034, -0.038769, -0.040072, -0.033721, -0.024200, -0.024436, -0.028913, -0.019837, -0.017493, -0.019692, -0.005634, -0.002745, -0.005258, -0.009892, -0.011077, -0.012813, -0.009153, 0.007730, -0.000373, -0.011167
#*# 	  -0.020328, -0.023640, -0.028265, -0.036458, -0.041170, -0.040802, -0.048995, -0.048426, -0.040196, -0.030187, -0.029321, -0.033695, -0.029144, -0.023559, -0.023259, -0.014351, -0.012258, -0.013402, -0.016817, -0.019376, -0.018015, -0.013045, 0.001938, -0.004650, -0.019777
#*# 	  -0.022834, -0.027063, -0.030699, -0.040537, -0.043805, -0.044759, -0.053186, -0.055401, -0.047830, -0.033049, -0.026866, -0.023346, -0.019826, -0.023598, -0.029822, -0.022713, -0.020494, -0.015845, -0.020617, -0.022927, -0.019614, -0.015166, -0.002689, -0.011374, -0.025112
#*# 	  -0.026251, -0.030230, -0.034597, -0.041577, -0.049081, -0.046126, -0.050035, -0.057794, -0.048640, -0.032247, -0.007902, 0.007180, 0.010705, -0.006141, -0.029708, -0.027234, -0.025044, -0.023657, -0.022424, -0.018471, -0.018528, -0.013082, -0.005036, -0.014222, -0.027409
#*# 	  -0.026575, -0.032167, -0.037888, -0.043994, -0.046354, -0.045077, -0.052442, -0.056930, -0.048199, -0.027346, 0.006343, 0.019751, 0.024678, 0.010798, -0.021722, -0.026556, -0.024834, -0.023442, -0.022313, -0.018582, -0.015109, -0.008913, -0.004911, -0.014149, -0.031177
#*# 	  -0.025591, -0.029474, -0.037318, -0.043656, -0.043964, -0.041886, -0.048458, -0.055058, -0.047243, -0.033071, -0.002532, 0.014778, 0.017396, 0.004024, -0.022297, -0.023563, -0.022691, -0.021098, -0.021473, -0.016508, -0.008981, -0.006378, -0.005445, -0.012895, -0.033217
#*# 	  -0.019072, -0.024889, -0.031905, -0.039951, -0.040786, -0.038859, -0.046005, -0.052781, -0.046432, -0.039351, -0.025408, -0.016122, -0.011114, -0.017171, -0.025181, -0.019742, -0.019253, -0.017973, -0.017185, -0.012916, -0.008007, -0.006129, -0.006114, -0.013945, -0.027891
#*# 	  -0.014079, -0.020567, -0.027911, -0.032547, -0.033595, -0.034569, -0.042461, -0.050300, -0.046178, -0.039225, -0.032883, -0.033388, -0.027409, -0.021576, -0.020550, -0.013568, -0.014241, -0.014370, -0.012792, -0.008028, -0.005951, -0.005458, -0.005006, -0.010299, -0.021378
#*# 	  -0.009198, -0.019362, -0.026873, -0.031412, -0.033688, -0.035878, -0.043830, -0.050482, -0.046878, -0.038356, -0.031970, -0.032235, -0.026286, -0.021832, -0.020030, -0.013642, -0.013153, -0.015344, -0.017144, -0.008736, -0.006137, -0.006218, -0.004410, -0.008573, -0.019655
#*# 	  -0.003661, -0.015095, -0.023620, -0.029204, -0.034417, -0.037050, -0.046362, -0.050627, -0.046161, -0.037657, -0.029659, -0.030023, -0.024742, -0.020672, -0.020850, -0.014516, -0.015768, -0.016034, -0.015040, -0.009852, -0.006693, -0.007034, -0.005444, -0.009277, -0.018634
#*# 	  0.007506, -0.006389, -0.014440, -0.022043, -0.028314, -0.030785, -0.038718, -0.045121, -0.038416, -0.029562, -0.023594, -0.023348, -0.018274, -0.015759, -0.017164, -0.012541, -0.013225, -0.012368, -0.010527, -0.005466, -0.003518, -0.002611, -0.001894, -0.006080, -0.016333
#*# 	  0.022125, 0.011748, 0.000929, -0.006817, -0.012750, -0.016181, -0.025228, -0.027317, -0.021446, -0.013916, -0.007556, -0.008660, -0.005664, -0.004921, -0.005998, -0.002719, -0.004428, -0.002883, -0.001685, 0.003487, 0.005434, 0.004689, 0.007757, 0.005353, -0.004954
#*# 	  0.025461, 0.012782, 0.002677, -0.003001, -0.008146, -0.010684, -0.017531, -0.019559, -0.013301, -0.006471, -0.000371, -0.003629, -0.001370, 0.000466, -0.001736, 0.001806, 0.000064, 0.000745, 0.000740, 0.005436, 0.007698, 0.006820, 0.008575, 0.007345, -0.002582
#*# 	  0.019387, 0.007731, 0.000079, -0.005960, -0.009038, -0.010581, -0.017977, -0.018284, -0.012804, -0.006831, -0.002206, -0.005566, -0.002460, -0.000760, -0.003848, -0.000319, -0.000280, -0.001122, -0.000236, 0.003326, 0.003771, 0.002862, 0.004757, 0.003231, -0.006073
#*# 	  0.004327, -0.004843, -0.011293, -0.015333, -0.015649, -0.015726, -0.020957, -0.023078, -0.018265, -0.013624, -0.010052, -0.013062, -0.009193, -0.006693, -0.009731, -0.004042, -0.005865, -0.005620, -0.003889, -0.001331, -0.001465, -0.004817, -0.002534, -0.004852, -0.015078
#*# 	  -0.003336, -0.011017, -0.016816, -0.018868, -0.019990, -0.018314, -0.025102, -0.026057, -0.022314, -0.019449, -0.017031, -0.020375, -0.017675, -0.014361, -0.016123, -0.011733, -0.011878, -0.010503, -0.008752, -0.005421, -0.007394, -0.010563, -0.009550, -0.013025, -0.024361
#*# 	  -0.006310, -0.015332, -0.019708, -0.020945, -0.021519, -0.022069, -0.026565, -0.028826, -0.025771, -0.025300, -0.024989, -0.026586, -0.023700, -0.020816, -0.023050, -0.017670, -0.017864, -0.016402, -0.015107, -0.011680, -0.011785, -0.017275, -0.018878, -0.022049, -0.033273
#*# 	  -0.004826, -0.013817, -0.018388, -0.018373, -0.021226, -0.020570, -0.028411, -0.031415, -0.027787, -0.028869, -0.027574, -0.030795, -0.027855, -0.025763, -0.026667, -0.021600, -0.021000, -0.020600, -0.020016, -0.016953, -0.016740, -0.021994, -0.023313, -0.026960, -0.039156
#*# 	  -0.006576, -0.015698, -0.021193, -0.023824, -0.024339, -0.026583, -0.034077, -0.038355, -0.035593, -0.033001, -0.033527, -0.037286, -0.035641, -0.033730, -0.035908, -0.029935, -0.030413, -0.029851, -0.029619, -0.027615, -0.028775, -0.033311, -0.034777, -0.038488, -0.050551
#*# 	  -0.007477, -0.018372, -0.023988, -0.025820, -0.027629, -0.031020, -0.040268, -0.045520, -0.042323, -0.039259, -0.038000, -0.042389, -0.042092, -0.042705, -0.045594, -0.040292, -0.041365, -0.041344, -0.041225, -0.039796, -0.041181, -0.046711, -0.048403, -0.051471, -0.064409
#*# 	  -0.005748, -0.015743, -0.021691, -0.026339, -0.028736, -0.033744, -0.045539, -0.051163, -0.045476, -0.041116, -0.040046, -0.043898, -0.043678, -0.044867, -0.047120, -0.042967, -0.045935, -0.046354, -0.046877, -0.044665, -0.046316, -0.053445, -0.054106, -0.057840, -0.069695
#*# 	  0.006518, -0.004899, -0.015129, -0.018953, -0.023979, -0.029100, -0.041353, -0.049261, -0.044047, -0.037171, -0.036249, -0.043594, -0.041196, -0.039401, -0.041185, -0.035597, -0.040687, -0.044115, -0.045808, -0.045034, -0.046851, -0.052779, -0.054505, -0.058638, -0.071020
#*# 	  0.023963, 0.009035, -0.003577, -0.010467, -0.016797, -0.020738, -0.033996, -0.041009, -0.036605, -0.027853, -0.030304, -0.039100, -0.037748, -0.034292, -0.034432, -0.029534, -0.034320, -0.039801, -0.043101, -0.043452, -0.046459, -0.052700, -0.055630, -0.057626, -0.069089
#*# 	  0.051346, 0.033864, 0.016961, 0.006925, 0.000875, -0.003628, -0.015658, -0.023398, -0.015574, -0.011345, -0.014401, -0.025998, -0.024437, -0.021528, -0.022414, -0.016729, -0.020815, -0.025396, -0.031011, -0.031798, -0.038050, -0.046102, -0.046241, -0.049043, -0.059289
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 270.0
