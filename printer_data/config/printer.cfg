# THIS CONFIG IS FOR USE WITH Leviathan, Beacon & EBB36

# Required Configs, Always include these
[include mainsail.cfg]
[include macros/*.cfg]
[include timelapse.cfg]
[include K-ShakeTune/*.cfg]

#####################################################################
#   MCU / Leviathan / EBB36
#####################################################################

[mcu]
canbus_uuid: 96476c0cc178

[mcu EBB36]
canbus_uuid: d03347641955

[temperature_sensor Leviathan]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBB36
min_temp: 0
max_temp: 100

[temperature_sensor RPi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100


#####################################################################
#   Machine
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 5.0

[idle_timeout]
timeout: 1800


#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to HV STEPPER 0
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0


#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
[stepper_z]
step_pin: PD4
dir_pin: PD3
enable_pin: !PD7
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: probe:z_virtual_endstop
position_max: 290
position_min: -2.5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0


[tmc2209 stepper_z]
uart_pin: PD5
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: PC11
enable_pin: !PD2
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: PD0
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: PC8
enable_pin: !PC10
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PA8
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBB36:PD0
dir_pin: !EBB36:PD1
enable_pin: !EBB36:PD2
rotation_distance: 22.50
gear_ratio: 50:8
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBB36:PB13
sensor_type: PT1000
pullup_resistor: 2200
sensor_pin: EBB36:PA3
min_temp: 10
max_temp: 350
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 500
max_extrude_cross_section: 5.0
pressure_advance: 0.02
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: EBB36:PA15
interpolate: false
run_current: 0.60
sense_resistor: 0.110
stealthchop_threshold: 0

[firmware_retraction]
retract_length: 0.5
retract_speed: 35
unretract_extra_length: 0.0
unretract_speed: 35


#####################################################################
#   ADXL / Input Shaper
#####################################################################

[resonance_tester]
accel_chip: beacon
accel_per_hz: 75
probe_points: 150, 150, 20

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 76.8
shaper_type_y = mzv
shaper_freq_y = 47.8


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PG11
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA1
pullup_resistor: 2200
max_power: 1
pwm_cycle_time: 0.0166
min_temp: 0
max_temp: 130


#####################################################################
#   Beacon
#####################################################################

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_2A25C8345154364134202020FF143F31-if00
x_offset: 0
y_offset: 22
mesh_main_direction: x
mesh_runs: 2


#####################################################################
#   Bed Mesh
#####################################################################

[bed_mesh]
speed: 450
mesh_min: 30,30
mesh_max: 270,270
probe_count: 25,25
algorithm: bicubic


#####################################################################
#   Z-Tilt
#####################################################################

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 12.5
   150, 252.5
   270, 12.5
speed: 450
retries: 10
retry_tolerance: 0.004
horizontal_move_z: 10


#####################################################################
#   Fan Control
#####################################################################

[fan]
pin: EBB36:PA0
kick_start_time: 0.5
off_below: 0.10

[heater_fan hotend_fan]
pin: EBB36:PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[controller_fan Controller_Fan]
pin: PF9
kick_start_time: 0.5
fan_speed: 0.50
idle_timeout: 1800


#####################################################################
# 	Chamber Thermistor
#####################################################################

[temperature_sensor Chamber]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA2
pullup_resistor: 2200
min_temp: 0
max_temp: 100
gcode_id: chamber_th


#####################################################################
# EXP1 / EXP2 (display) pins
#####################################################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.606
#*# pid_ki = 1.164
#*# pid_kd = 91.181
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.636
#*# pid_ki = 4.376
#*# pid_kd = 246.136
#*#
#*# [beacon model default]
#*# model_coef = 1.4224131212906368,
#*# 	  1.760719564188449,
#*# 	  0.7911225972478116,
#*# 	  0.36898690428732855,
#*# 	  0.4102733854437782,
#*# 	  0.5147817459642499,
#*# 	  -0.2234086581135876,
#*# 	  -0.5490160428371165,
#*# 	  0.19906423572651866,
#*# 	  0.30632251599727406
#*# model_domain = 1.7921810629123274e-07,1.928696912017407e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 26.977205
#*# model_offset = 0.05600
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.008494, 0.003686, -0.002438, -0.011302, -0.015065, -0.014526, -0.020831, -0.022448, -0.016418, -0.007916, -0.008604, -0.013581, -0.008538, -0.001891, -0.000067, 0.008391, 0.010427, 0.009104, 0.005462, 0.005524, 0.004782, 0.007453, 0.023392, 0.018810, 0.008324
#*# 	  0.006368, 0.000209, -0.006763, -0.016769, -0.021504, -0.021769, -0.027779, -0.029064, -0.021804, -0.013262, -0.014291, -0.019544, -0.009396, -0.009946, -0.004001, 0.005303, 0.006727, 0.004211, 0.000368, 0.000083, -0.000556, 0.004804, 0.024898, 0.019454, 0.009257
#*# 	  0.001988, -0.007432, -0.013004, -0.025461, -0.028208, -0.031027, -0.038170, -0.040495, -0.032926, -0.020692, -0.021970, -0.025092, -0.019912, -0.014558, -0.014134, -0.005131, -0.004549, -0.005110, -0.008669, -0.007971, -0.007617, -0.001345, 0.016113, 0.011567, -0.001875
#*# 	  -0.007126, -0.013790, -0.019325, -0.028727, -0.035695, -0.036225, -0.044954, -0.048608, -0.041069, -0.026467, -0.018830, -0.015047, -0.010294, -0.018034, -0.022143, -0.016188, -0.013564, -0.012717, -0.013149, -0.011493, -0.009267, -0.003970, 0.007874, 0.003450, -0.008668
#*# 	  -0.010727, -0.019862, -0.025487, -0.034862, -0.039635, -0.039554, -0.048542, -0.052571, -0.043332, -0.026455, -0.000013, 0.014482, 0.016977, -0.001526, -0.024662, -0.021351, -0.019688, -0.017730, -0.016225, -0.012514, -0.010586, -0.003776, 0.003648, -0.003411, -0.018634
#*# 	  -0.017581, -0.023745, -0.030883, -0.039456, -0.040407, -0.040087, -0.048225, -0.051845, -0.041268, -0.026210, 0.012800, 0.025536, 0.029643, 0.013297, -0.018957, -0.021986, -0.021677, -0.019342, -0.017506, -0.013430, -0.008273, 0.003352, 0.001069, -0.005411, -0.021301
#*# 	  -0.015705, -0.025701, -0.032737, -0.040855, -0.039980, -0.039099, -0.047010, -0.050879, -0.041994, -0.029212, 0.000881, 0.017040, 0.021474, 0.005195, -0.021938, -0.021205, -0.020528, -0.018878, -0.017440, -0.012807, -0.004862, 0.000146, -0.000464, -0.005566, -0.021248
#*# 	  -0.014010, -0.020401, -0.027266, -0.036273, -0.036146, -0.033895, -0.041937, -0.046985, -0.041531, -0.036426, -0.023760, -0.015760, -0.007907, -0.016291, -0.020633, -0.017658, -0.015974, -0.014768, -0.013697, -0.008670, -0.002650, -0.000369, -0.001822, -0.007853, -0.019018
#*# 	  -0.008397, -0.017966, -0.023643, -0.031939, -0.032573, -0.032819, -0.039524, -0.045295, -0.043620, -0.037693, -0.032103, -0.032345, -0.024595, -0.020715, -0.019692, -0.012114, -0.012130, -0.011423, -0.009635, -0.004867, -0.003029, -0.003352, -0.002438, -0.005970, -0.014580
#*# 	  -0.007936, -0.017685, -0.024889, -0.028924, -0.030906, -0.033043, -0.041240, -0.046391, -0.042867, -0.036712, -0.029701, -0.030718, -0.024829, -0.019793, -0.018406, -0.011441, -0.010674, -0.011145, -0.012255, -0.005193, -0.004154, -0.003837, -0.001264, -0.004099, -0.013821
#*# 	  -0.002741, -0.014709, -0.022605, -0.028157, -0.030475, -0.032832, -0.043299, -0.048031, -0.043075, -0.034779, -0.029097, -0.029279, -0.023206, -0.019155, -0.018169, -0.011753, -0.012957, -0.012473, -0.012371, -0.007785, -0.006287, -0.005677, -0.003143, -0.006154, -0.014342
#*# 	  0.003780, -0.007747, -0.015480, -0.021162, -0.024147, -0.027882, -0.036674, -0.040891, -0.034532, -0.028579, -0.020198, -0.021001, -0.016694, -0.014386, -0.014311, -0.010061, -0.009972, -0.009005, -0.008317, -0.004120, -0.003092, -0.002979, -0.000515, -0.003170, -0.011499
#*# 	  0.017856, 0.006867, -0.002220, -0.007880, -0.011474, -0.016174, -0.021798, -0.026655, -0.020027, -0.013166, -0.007375, -0.008789, -0.006158, -0.004115, -0.004246, 0.000157, -0.001503, -0.000902, 0.000931, 0.005315, 0.005772, 0.005141, 0.006023, 0.004441, -0.004260
#*# 	  0.025884, 0.010472, 0.001540, -0.003290, -0.005227, -0.007720, -0.015438, -0.017294, -0.010464, -0.004714, -0.000562, -0.003187, -0.000145, 0.001179, -0.001045, 0.005336, 0.003556, 0.003598, 0.004697, 0.008769, 0.009880, 0.007263, 0.008518, 0.007434, -0.000387
#*# 	  0.019746, 0.006540, -0.001033, -0.005822, -0.007346, -0.009048, -0.014922, -0.017083, -0.011170, -0.005922, -0.002257, -0.006659, -0.002503, -0.000212, -0.002898, 0.002570, 0.001677, 0.001510, 0.001771, 0.005909, 0.004293, 0.001968, 0.003138, 0.000849, -0.007375
#*# 	  0.007528, -0.001618, -0.008003, -0.011224, -0.012128, -0.011788, -0.018386, -0.020815, -0.013608, -0.010540, -0.007648, -0.011759, -0.008829, -0.007144, -0.008927, -0.004310, -0.004179, -0.003617, -0.002936, 0.000991, -0.002398, -0.004643, -0.004302, -0.007184, -0.015217
#*# 	  0.000236, -0.006709, -0.012688, -0.016339, -0.016206, -0.015640, -0.022077, -0.023299, -0.019339, -0.017209, -0.014706, -0.018525, -0.016870, -0.013964, -0.014949, -0.009638, -0.010222, -0.009205, -0.007406, -0.005109, -0.007122, -0.011575, -0.011689, -0.014741, -0.024783
#*# 	  -0.002935, -0.009614, -0.014713, -0.018453, -0.018398, -0.018873, -0.025597, -0.027324, -0.023813, -0.022436, -0.022754, -0.025610, -0.021160, -0.020693, -0.020145, -0.015259, -0.015132, -0.015105, -0.014153, -0.010176, -0.012511, -0.016003, -0.018102, -0.021968, -0.030808
#*# 	  0.002011, -0.006578, -0.013043, -0.015018, -0.016239, -0.017279, -0.026286, -0.028925, -0.025427, -0.025044, -0.024488, -0.028219, -0.025294, -0.023073, -0.022144, -0.016691, -0.017639, -0.017616, -0.017934, -0.014769, -0.014959, -0.019793, -0.021921, -0.025264, -0.036601
#*# 	  0.002600, -0.007297, -0.013180, -0.016361, -0.018184, -0.021391, -0.030650, -0.033936, -0.030630, -0.028891, -0.029117, -0.033363, -0.031908, -0.030281, -0.030719, -0.023846, -0.025513, -0.024426, -0.025827, -0.023810, -0.025400, -0.029589, -0.030722, -0.035005, -0.046352
#*# 	  0.003276, -0.007644, -0.013811, -0.017634, -0.020770, -0.023017, -0.034027, -0.038939, -0.034948, -0.032602, -0.031934, -0.037017, -0.034726, -0.035973, -0.038149, -0.033499, -0.034346, -0.034390, -0.034675, -0.032636, -0.036043, -0.040229, -0.041740, -0.046590, -0.057655
#*# 	  0.007121, -0.003739, -0.010639, -0.017133, -0.019357, -0.025089, -0.037101, -0.042001, -0.036811, -0.033254, -0.031711, -0.037106, -0.036004, -0.036843, -0.039186, -0.034670, -0.038651, -0.038348, -0.039513, -0.038494, -0.040446, -0.046295, -0.047556, -0.051102, -0.063395
#*# 	  0.021142, 0.009286, 0.000216, -0.007074, -0.011658, -0.016491, -0.030785, -0.036607, -0.031253, -0.024119, -0.024786, -0.032296, -0.028965, -0.028790, -0.027965, -0.025590, -0.030132, -0.033367, -0.035210, -0.033841, -0.036427, -0.042004, -0.043475, -0.047546, -0.059971
#*# 	  0.040108, 0.025843, 0.014520, 0.005316, -0.000502, -0.005155, -0.019668, -0.025748, -0.018221, -0.011927, -0.015477, -0.024184, -0.021419, -0.019152, -0.019062, -0.014977, -0.020092, -0.025114, -0.028976, -0.029187, -0.032503, -0.039003, -0.040964, -0.044035, -0.055444
#*# 	  0.075073, 0.056412, 0.039767, 0.028619, 0.020939, 0.016366, 0.002840, -0.003352, 0.004552, 0.009141, 0.003913, -0.006419, -0.004496, -0.002952, -0.002006, 0.002358, -0.002788, -0.005880, -0.012667, -0.013129, -0.018961, -0.028011, -0.028582, -0.030356, -0.040596
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 270.0
