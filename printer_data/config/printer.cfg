# THIS CONFIG IS FOR USE WITH Leviathan, Beacon & EBB36

# Required Configs, Always include these
[include mainsail.cfg]
[include macros/*.cfg]
[include timelapse.cfg]
[include K-ShakeTune/*.cfg]

#####################################################################
#   MCU / Leviathan / EBB36
#####################################################################

[mcu]
canbus_uuid: 96476c0cc178

[mcu EBB36]
canbus_uuid: d03347641955

[temperature_sensor Leviathan]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBB36
min_temp: 0
max_temp: 100

[temperature_sensor RPi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100


#####################################################################
#   Machine
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 5.0

[idle_timeout]
timeout: 1800


#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to HV STEPPER 0
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0


#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
[stepper_z]
step_pin: PD4
dir_pin: PD3
enable_pin: !PD7
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: probe:z_virtual_endstop
position_max: 290
position_min: -2.5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0


[tmc2209 stepper_z]
uart_pin: PD5
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: PC11
enable_pin: !PD2
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: PD0
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: PC8
enable_pin: !PC10
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PA8
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBB36:PD0
dir_pin: !EBB36:PD1
enable_pin: !EBB36:PD2
rotation_distance: 22.50
gear_ratio: 50:8
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBB36:PB13
sensor_type: PT1000
pullup_resistor: 2200
sensor_pin: EBB36:PA3
min_temp: 10
max_temp: 350
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 500
max_extrude_cross_section: 5.0
pressure_advance: 0.02
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: EBB36:PA15
interpolate: false
run_current: 0.60
sense_resistor: 0.110
stealthchop_threshold: 0

[firmware_retraction]
retract_length: 0.5
retract_speed: 35
unretract_extra_length: 0.0
unretract_speed: 35


#####################################################################
#   ADXL / Input Shaper
#####################################################################

[resonance_tester]
accel_chip: beacon
accel_per_hz: 75
probe_points: 150, 150, 20

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 73.4
shaper_type_y = zv
shaper_freq_y = 53.4


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PG11
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA1
pullup_resistor: 2200
max_power: 1
pwm_cycle_time: 0.0166
min_temp: 0
max_temp: 130


#####################################################################
#   Beacon
#####################################################################

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_2A25C8345154364134202020FF143F31-if00
x_offset: 0
y_offset: 22
mesh_main_direction: x
mesh_runs: 2


#####################################################################
#   Bed Mesh
#####################################################################

[bed_mesh]
speed: 450
mesh_min: 30,30
mesh_max: 270,270
probe_count: 25,25
algorithm: bicubic


#####################################################################
#   Z-Tilt
#####################################################################

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 12.5
   150, 252.5
   270, 12.5
speed: 450
retries: 10
retry_tolerance: 0.004
horizontal_move_z: 10


#####################################################################
#   Fan Control
#####################################################################

[fan]
pin: EBB36:PA0
kick_start_time: 0.5
off_below: 0.10

[heater_fan hotend_fan]
pin: EBB36:PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[controller_fan Controller_Fan]
pin: PF9
kick_start_time: 0.5
fan_speed: 0.50
idle_timeout: 1800


#####################################################################
# 	Chamber Thermistor
#####################################################################

[temperature_sensor Chamber]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA2
pullup_resistor: 2200
min_temp: 0
max_temp: 100
gcode_id: chamber_th


#####################################################################
# EXP1 / EXP2 (display) pins
#####################################################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.518
#*# pid_ki = 1.267
#*# pid_kd = 83.098
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.636
#*# pid_ki = 4.376
#*# pid_kd = 246.136
#*#
#*# [beacon model default]
#*# model_coef = 1.4224131212906368,
#*# 	1.760719564188449,
#*# 	0.7911225972478116,
#*# 	0.36898690428732855,
#*# 	0.4102733854437782,
#*# 	0.5147817459642499,
#*# 	-0.2234086581135876,
#*# 	-0.5490160428371165,
#*# 	0.19906423572651866,
#*# 	0.30632251599727406
#*# model_domain = 1.7921810629123274e-07,1.928696912017407e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 26.977205
#*# model_offset = 0.12900
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.003992, 0.002904, 0.003643, 0.004319, 0.011030, 0.017254, 0.015115, 0.020766, 0.031886, 0.038787, 0.039875, 0.037003, 0.043347, 0.045156, 0.046776, 0.049955, 0.046624, 0.039883, 0.032994, 0.026956, 0.020358, 0.019123, 0.025227, 0.013527, -0.008126
#*# 	  -0.012639, -0.007038, -0.006947, -0.005747, -0.000535, 0.004389, 0.003238, 0.009619, 0.020605, 0.029284, 0.028680, 0.025099, 0.031492, 0.035885, 0.037656, 0.042705, 0.038952, 0.031617, 0.022380, 0.017656, 0.011782, 0.014547, 0.025176, 0.013252, -0.008400
#*# 	  -0.023794, -0.018425, -0.017225, -0.017658, -0.013619, -0.009216, -0.011116, -0.005821, 0.007891, 0.018242, 0.017731, 0.015418, 0.023635, 0.024051, 0.026016, 0.029639, 0.025165, 0.018971, 0.011736, 0.008085, 0.004500, 0.008704, 0.014873, 0.006389, -0.017046
#*# 	  -0.035157, -0.029508, -0.026832, -0.027821, -0.024010, -0.020520, -0.023265, -0.020085, -0.004879, 0.008155, 0.015159, 0.018620, 0.021637, 0.013429, 0.010886, 0.014807, 0.012111, 0.007811, 0.003530, 0.000192, -0.003185, 0.000600, -0.000330, -0.008448, -0.028436
#*# 	  -0.046272, -0.039052, -0.038280, -0.038433, -0.033691, -0.029949, -0.033307, -0.029731, -0.012777, 0.005821, 0.032491, 0.042144, 0.040999, 0.016314, 0.002044, 0.003817, 0.000922, -0.002592, -0.005255, -0.005710, -0.007353, -0.001451, -0.008713, -0.017696, -0.039546
#*# 	  -0.053170, -0.046890, -0.044719, -0.044285, -0.036160, -0.032184, -0.035503, -0.032890, -0.014402, 0.009569, 0.047190, 0.053870, 0.056640, 0.028190, 0.001405, -0.001026, -0.001872, -0.004358, -0.007205, -0.007019, -0.007469, -0.001378, -0.012689, -0.022053, -0.044002
#*# 	  -0.057759, -0.049579, -0.048013, -0.046268, -0.036956, -0.030891, -0.033996, -0.031307, -0.014392, 0.005295, 0.038560, 0.048659, 0.050070, 0.024272, 0.001834, 0.000918, -0.000415, -0.003880, -0.007051, -0.005183, -0.005003, -0.000567, -0.012825, -0.024006, -0.045575
#*# 	  -0.059839, -0.052674, -0.050407, -0.047415, -0.038043, -0.032633, -0.034054, -0.033184, -0.022209, -0.011055, 0.005499, 0.012834, 0.017701, 0.003426, -0.001532, 0.000695, -0.001857, -0.003661, -0.006302, -0.005449, -0.006435, -0.009771, -0.016028, -0.029273, -0.045101
#*# 	  -0.061610, -0.056416, -0.052452, -0.047978, -0.039569, -0.032902, -0.035261, -0.034854, -0.026311, -0.018518, -0.013461, -0.011442, -0.003028, -0.002793, 0.000362, 0.002539, -0.000647, -0.003240, -0.006868, -0.005811, -0.009567, -0.013919, -0.018664, -0.027873, -0.043623
#*# 	  -0.064937, -0.060752, -0.055099, -0.048983, -0.040570, -0.035610, -0.038435, -0.038320, -0.029675, -0.020573, -0.014305, -0.012342, -0.005479, -0.004419, -0.000709, 0.001993, -0.001736, -0.004737, -0.008018, -0.007685, -0.012172, -0.015860, -0.018723, -0.027098, -0.041433
#*# 	  -0.069389, -0.063643, -0.059798, -0.053214, -0.045880, -0.042081, -0.045758, -0.043118, -0.033874, -0.021794, -0.014383, -0.013961, -0.006522, -0.005173, -0.005263, -0.002070, -0.005426, -0.008049, -0.011433, -0.011636, -0.015936, -0.019006, -0.021605, -0.030465, -0.044114
#*# 	  -0.064935, -0.060144, -0.055802, -0.051552, -0.043434, -0.040640, -0.043171, -0.041501, -0.029618, -0.019226, -0.010990, -0.010053, -0.004551, -0.004901, -0.003833, -0.004004, -0.006391, -0.008140, -0.011494, -0.010641, -0.015420, -0.019144, -0.021579, -0.028960, -0.042270
#*# 	  -0.053008, -0.051733, -0.047760, -0.043141, -0.036717, -0.033266, -0.035285, -0.030435, -0.019096, -0.008891, -0.001468, -0.002037, 0.002435, 0.001406, 0.000471, 0.000618, -0.002187, -0.003931, -0.007277, -0.006153, -0.010160, -0.015436, -0.018171, -0.024525, -0.038505
#*# 	  -0.042445, -0.046947, -0.043365, -0.038770, -0.032509, -0.027674, -0.028518, -0.024184, -0.012541, -0.003097, 0.002412, 0.000842, 0.005611, 0.004358, 0.003015, 0.005159, 0.000984, -0.002908, -0.005222, -0.003828, -0.009536, -0.013980, -0.016626, -0.023279, -0.036280
#*# 	  -0.048462, -0.051194, -0.047530, -0.041990, -0.035397, -0.029677, -0.029422, -0.023785, -0.012452, -0.002811, 0.000729, -0.001378, 0.003367, 0.003168, 0.002010, 0.003243, -0.000648, -0.002954, -0.006219, -0.007233, -0.012948, -0.017418, -0.021771, -0.027596, -0.041432
#*# 	  -0.065599, -0.063399, -0.057621, -0.053156, -0.043622, -0.036939, -0.035929, -0.030824, -0.020484, -0.013284, -0.009216, -0.011523, -0.006359, -0.006973, -0.006768, -0.006053, -0.010214, -0.011235, -0.014660, -0.016243, -0.021919, -0.027143, -0.029956, -0.037729, -0.050688
#*# 	  -0.076983, -0.071367, -0.065678, -0.059746, -0.050130, -0.042850, -0.042116, -0.035316, -0.026541, -0.020232, -0.017198, -0.018894, -0.014587, -0.014616, -0.015110, -0.012864, -0.016440, -0.017799, -0.020789, -0.020876, -0.028243, -0.034824, -0.038150, -0.045813, -0.061316
#*# 	  -0.082054, -0.076425, -0.070306, -0.063095, -0.052851, -0.046364, -0.044848, -0.040730, -0.032345, -0.028569, -0.024744, -0.026963, -0.021271, -0.020850, -0.021370, -0.018846, -0.021509, -0.023565, -0.026938, -0.026393, -0.032165, -0.039665, -0.043994, -0.052457, -0.067093
#*# 	  -0.083262, -0.077566, -0.071330, -0.063037, -0.054854, -0.047898, -0.049696, -0.044972, -0.036470, -0.032319, -0.031141, -0.031864, -0.026974, -0.026581, -0.026303, -0.023426, -0.025958, -0.027417, -0.032242, -0.032557, -0.038750, -0.046141, -0.052058, -0.058457, -0.074040
#*# 	  -0.082633, -0.078886, -0.072378, -0.064984, -0.056390, -0.050957, -0.053256, -0.049468, -0.042226, -0.037580, -0.035116, -0.038227, -0.033142, -0.034101, -0.033680, -0.030384, -0.033975, -0.036323, -0.039791, -0.041743, -0.048881, -0.055151, -0.059933, -0.068560, -0.082259
#*# 	  -0.085165, -0.082198, -0.076462, -0.069500, -0.061943, -0.057353, -0.060135, -0.056815, -0.048171, -0.042304, -0.038688, -0.042261, -0.038888, -0.041874, -0.043371, -0.040028, -0.043209, -0.046352, -0.050521, -0.051688, -0.059446, -0.067166, -0.071939, -0.079563, -0.095187
#*# 	  -0.085578, -0.082131, -0.076482, -0.070160, -0.063441, -0.060323, -0.065733, -0.062505, -0.052413, -0.043923, -0.041251, -0.044419, -0.041477, -0.044545, -0.046632, -0.045879, -0.049632, -0.053526, -0.057507, -0.059461, -0.065655, -0.075025, -0.079719, -0.088039, -0.101644
#*# 	  -0.075218, -0.072318, -0.070021, -0.064408, -0.059240, -0.057034, -0.063966, -0.061813, -0.048891, -0.039832, -0.037964, -0.042482, -0.038455, -0.039172, -0.039889, -0.038798, -0.046149, -0.051134, -0.057525, -0.059415, -0.065545, -0.075007, -0.079948, -0.088019, -0.104327
#*# 	  -0.058341, -0.057980, -0.057675, -0.054510, -0.049875, -0.047052, -0.054131, -0.051389, -0.038165, -0.028458, -0.029151, -0.036368, -0.031691, -0.029533, -0.029875, -0.028701, -0.037227, -0.044359, -0.052152, -0.054453, -0.062837, -0.072605, -0.075567, -0.084024, -0.098248
#*# 	  -0.029611, -0.033303, -0.036299, -0.034414, -0.031329, -0.027109, -0.033389, -0.032553, -0.017460, -0.009551, -0.012751, -0.020003, -0.015402, -0.014953, -0.014637, -0.011510, -0.021027, -0.027250, -0.036223, -0.041068, -0.050611, -0.061531, -0.064989, -0.070838, -0.083663
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 270.0
