# THIS CONFIG IS FOR USE WITH Leviathan, Beacon & EBB36

# Required Configs, Always include these
[include mainsail.cfg]
[include macros/*.cfg]
[include timelapse.cfg]
[include K-ShakeTune/*.cfg]

#####################################################################
#   MCU / Leviathan / EBB36
#####################################################################

[mcu]
canbus_uuid: 96476c0cc178

[mcu EBB36]
canbus_uuid: d03347641955

[temperature_sensor Leviathan]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBB36
min_temp: 0
max_temp: 100

[temperature_sensor RPi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100


#####################################################################
#   Machine
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 5.0

[idle_timeout]
timeout: 1800


#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to HV STEPPER 0
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
driver_SGT: 0
interpolate: False
run_current: 1.3
sense_resistor: 0.075
stealthchop_threshold: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
driver_SGT: 0
interpolate: False
run_current: 1.3
sense_resistor: 0.075
stealthchop_threshold: 0


#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
[stepper_z]
step_pin: PD4
dir_pin: PD3
enable_pin: !PD7
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: probe:z_virtual_endstop
position_max: 290
position_min: -2.5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0


[tmc2209 stepper_z]
uart_pin: PD5
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: PC11
enable_pin: !PD2
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: PD0
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: PC8
enable_pin: !PC10
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PA8
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBB36:PD0
dir_pin: !EBB36:PD1
enable_pin: !EBB36:PD2
rotation_distance: 22.50
gear_ratio: 50:8
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBB36:PB13
sensor_type: PT1000
pullup_resistor: 2200
sensor_pin: EBB36:PA3
min_temp: 10
max_temp: 350
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 500
max_extrude_cross_section: 5.0
pressure_advance: 0.02
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: EBB36:PA15
interpolate: false
run_current: 0.60
sense_resistor: 0.110
stealthchop_threshold: 0

[firmware_retraction]
retract_length: 0.5
retract_speed: 35
unretract_extra_length: 0.0
unretract_speed: 35


#####################################################################
#   ADXL / Input Shaper
#####################################################################

[resonance_tester]
accel_chip: beacon
accel_per_hz: 75
probe_points: 150, 150, 20

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 76.8
shaper_type_y = mzv
shaper_freq_y = 47.8


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PG11
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA1
pullup_resistor: 2200
max_power: 1
pwm_cycle_time: 0.0166
min_temp: 0
max_temp: 130


#####################################################################
#   Beacon
#####################################################################

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_2A25C8345154364134202020FF143F31-if00
x_offset: 0
y_offset: 22
mesh_main_direction: x
mesh_runs: 2


#####################################################################
#   Bed Mesh
#####################################################################

[bed_mesh]
speed: 450
mesh_min: 30,30
mesh_max: 270,270
probe_count: 25,25
algorithm: bicubic


#####################################################################
#   Z-Tilt
#####################################################################

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 12.5
   150, 252.5
   270, 12.5
speed: 450
retries: 10
retry_tolerance: 0.004
horizontal_move_z: 10


#####################################################################
#   Fan Control
#####################################################################

[fan]
pin: EBB36:PA0
kick_start_time: 0.5
off_below: 0.10

[heater_fan hotend_fan]
pin: EBB36:PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[controller_fan Controller_Fan]
pin: PF9
kick_start_time: 0.5
fan_speed: 0.50
idle_timeout: 1800


#####################################################################
# 	Chamber Thermistor
#####################################################################

[temperature_sensor Chamber]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA2
pullup_resistor: 2200
min_temp: 0
max_temp: 100
gcode_id: chamber_th


#####################################################################
# EXP1 / EXP2 (display) pins
#####################################################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.606
#*# pid_ki = 1.164
#*# pid_kd = 91.181
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.636
#*# pid_ki = 4.376
#*# pid_kd = 246.136
#*#
#*# [beacon model default]
#*# model_coef = 1.4224131212906368,
#*# 	1.760719564188449,
#*# 	0.7911225972478116,
#*# 	0.36898690428732855,
#*# 	0.4102733854437782,
#*# 	0.5147817459642499,
#*# 	-0.2234086581135876,
#*# 	-0.5490160428371165,
#*# 	0.19906423572651866,
#*# 	0.30632251599727406
#*# model_domain = 1.7921810629123274e-07,1.928696912017407e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 26.977205
#*# model_offset = 0.08800
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.033373, 0.043150, 0.045766, 0.042407, 0.036533, 0.035413, 0.023800, 0.034585, 0.038247, 0.043992, 0.035114, 0.025196, 0.031002, 0.035853, 0.048149, 0.056437, 0.061097, 0.065012, 0.070276, 0.053347, 0.063721, 0.059179, 0.056091, 0.051514, 0.041230
#*# 	  0.031257, 0.040952, 0.041555, 0.035842, 0.028283, 0.025488, 0.023821, 0.026957, 0.031355, 0.030025, 0.033376, 0.017905, 0.023346, 0.026324, 0.039901, 0.048351, 0.053147, 0.059061, 0.055256, 0.056615, 0.057284, 0.053714, 0.053678, 0.055070, 0.039152
#*# 	  0.030123, 0.027680, 0.034719, 0.026169, 0.017017, 0.013555, 0.011440, 0.014488, 0.019027, 0.025510, 0.016738, 0.006248, 0.011725, 0.024719, 0.019299, 0.037826, 0.041702, 0.048272, 0.046071, 0.047068, 0.047981, 0.043551, 0.041906, 0.038660, 0.035597
#*# 	  0.023812, 0.021832, 0.026062, 0.015669, 0.005868, 0.001996, -0.000994, 0.002343, 0.008578, 0.016226, 0.006692, -0.008129, -0.003454, 0.001833, 0.017526, 0.028387, 0.032670, 0.038889, 0.037509, 0.039341, 0.039692, 0.036290, 0.032297, 0.028774, 0.027488
#*# 	  0.016564, 0.011967, 0.021324, 0.008278, -0.002244, -0.008079, -0.011277, -0.008288, 0.006294, -0.000064, -0.006043, -0.025452, -0.025160, -0.018151, 0.002902, 0.019371, 0.021996, 0.028869, 0.026809, 0.029186, 0.031770, 0.036191, 0.019399, 0.019726, 0.007586
#*# 	  0.012867, 0.005579, 0.018534, -0.001371, -0.000911, -0.013051, -0.017585, -0.015021, -0.008663, -0.001683, -0.017046, -0.037645, -0.039107, -0.032192, -0.007500, 0.011331, 0.010755, 0.023376, 0.016233, 0.020329, 0.024800, 0.023084, 0.019699, 0.013916, 0.006103
#*# 	  0.001563, 0.002631, 0.014028, 0.004968, -0.005609, -0.012580, -0.017634, -0.022207, -0.009767, -0.003894, -0.016942, -0.035894, -0.035731, -0.029985, -0.009635, 0.006783, 0.009069, 0.012535, 0.010878, 0.015605, 0.013477, 0.019591, 0.017923, 0.010983, 0.004401
#*# 	  0.004268, 0.001907, 0.007836, 0.005538, -0.003886, -0.006972, -0.013268, -0.011506, -0.007539, 0.004425, -0.008059, -0.023072, -0.019382, -0.017053, -0.003440, 0.006259, 0.008797, 0.010827, 0.010838, 0.015656, 0.021498, 0.021367, 0.024370, 0.014608, 0.013317
#*# 	  0.010220, 0.008703, 0.003518, 0.006702, 0.000963, -0.003014, -0.007724, -0.008195, -0.002343, 0.004832, -0.001660, -0.012484, -0.008541, -0.006246, 0.008150, 0.002590, 0.008608, 0.011633, 0.010830, 0.017178, 0.022773, 0.022478, 0.019793, 0.016145, 0.006806
#*# 	  0.010683, 0.002244, 0.007668, 0.007900, 0.000475, -0.003962, -0.009626, -0.007953, -0.002604, 0.005475, -0.004729, -0.008992, -0.003498, -0.004859, 0.004762, 0.006521, 0.007047, 0.009387, 0.008361, 0.014428, 0.021615, 0.021337, 0.016840, 0.011450, 0.009499
#*# 	  0.013148, 0.005626, 0.009017, 0.007034, 0.000152, -0.006239, -0.012349, -0.011429, -0.005744, 0.008387, 0.000315, -0.007963, -0.003030, -0.002791, 0.002851, 0.006971, 0.006854, 0.006501, 0.005223, 0.012737, 0.019085, 0.018649, 0.017935, 0.007895, 0.020624
#*# 	  0.014993, 0.010964, 0.013791, 0.016814, 0.005249, -0.000653, -0.007952, -0.007940, -0.001831, 0.007644, 0.005019, -0.001728, 0.003105, 0.003404, 0.007931, 0.007654, 0.013200, 0.010092, 0.008888, 0.014947, 0.021919, 0.021573, 0.017912, 0.018639, 0.025606
#*# 	  0.028505, 0.023847, 0.028686, 0.024761, 0.015640, 0.010489, 0.004777, 0.004553, 0.005086, 0.017941, 0.014696, 0.008740, 0.012324, 0.013282, 0.017787, 0.019926, 0.018190, 0.018381, 0.016527, 0.023003, 0.029320, 0.023984, 0.026237, 0.027746, 0.036734
#*# 	  0.033935, 0.027537, 0.033496, 0.030964, 0.021367, 0.015350, 0.010260, 0.007773, 0.016880, 0.021683, 0.017590, 0.010739, 0.017244, 0.016785, 0.020616, 0.023111, 0.020579, 0.021142, 0.019524, 0.024607, 0.029950, 0.031530, 0.026524, 0.036873, 0.030086
#*# 	  0.036703, 0.027347, 0.033760, 0.028302, 0.018943, 0.012173, 0.007700, 0.007031, 0.010447, 0.017821, 0.013565, 0.006858, 0.012184, 0.012854, 0.016089, 0.022600, 0.013847, 0.016026, 0.013906, 0.017522, 0.023274, 0.020771, 0.017348, 0.021387, 0.023847
#*# 	  0.028236, 0.021801, 0.025330, 0.023111, 0.013333, 0.007228, 0.001369, 0.000345, 0.004508, 0.009105, 0.006100, -0.002596, 0.003010, 0.005312, 0.008721, 0.011211, 0.008888, 0.008840, 0.005777, 0.010707, 0.014520, 0.011895, 0.006089, 0.007143, 0.006730
#*# 	  0.026198, 0.018647, 0.019965, 0.017951, 0.008981, 0.002264, -0.003483, -0.003794, -0.001628, 0.006038, 0.000178, -0.009062, -0.005215, -0.003959, 0.000009, 0.005346, 0.004763, 0.004378, 0.001269, 0.005928, 0.009812, 0.005375, 0.001621, -0.000307, -0.006419
#*# 	  0.022386, 0.011888, 0.017617, 0.014163, 0.006200, 0.001219, -0.005715, -0.005803, -0.003676, 0.001383, -0.002355, -0.013389, -0.009571, -0.009363, -0.002729, 0.001697, 0.000713, 0.000643, -0.002439, 0.003322, 0.007407, 0.002209, -0.002763, -0.006195, -0.009436
#*# 	  0.024736, 0.014343, 0.016636, 0.015445, 0.009012, 0.002901, -0.002525, -0.004324, -0.001812, 0.002144, -0.002115, -0.011077, -0.007997, -0.008633, -0.002919, 0.000735, 0.002252, 0.002073, -0.001223, 0.002832, 0.007331, 0.002344, -0.003534, -0.007007, -0.011870
#*# 	  0.024114, 0.013681, 0.014552, 0.015310, 0.008503, 0.001866, -0.006472, -0.005497, -0.004899, -0.000148, -0.003989, -0.014611, -0.011065, -0.010985, -0.006546, -0.002400, -0.002940, -0.001934, -0.005404, -0.001613, 0.002257, -0.001966, -0.006143, -0.010393, -0.015300
#*# 	  0.021584, 0.009845, 0.014135, 0.013333, 0.005525, 0.000050, -0.007660, -0.010202, -0.009886, -0.005546, -0.011285, -0.020461, -0.015631, -0.017227, -0.012021, -0.008404, -0.008549, -0.007924, -0.010104, -0.008339, -0.004986, -0.010292, -0.015613, -0.017817, -0.021386
#*# 	  0.023588, 0.013642, 0.017162, 0.015108, 0.008870, 0.001376, -0.006320, -0.009687, -0.010490, -0.006619, -0.012442, -0.021001, -0.016126, -0.016377, -0.012303, -0.007482, -0.007275, -0.006955, -0.010413, -0.009347, -0.005308, -0.011783, -0.017402, -0.020623, -0.025376
#*# 	  0.036309, 0.025037, 0.028505, 0.027397, 0.020189, 0.011808, 0.002926, -0.001349, -0.003758, 0.000908, -0.004107, -0.012863, -0.006550, -0.008222, -0.005262, -0.000441, 0.000227, -0.000010, -0.004348, -0.003090, 0.000365, -0.004428, -0.011389, -0.015742, -0.021720
#*# 	  0.048664, 0.040084, 0.042988, 0.041954, 0.032690, 0.024289, 0.013021, 0.009309, 0.007697, 0.011484, 0.007312, -0.002957, 0.004127, 0.001494, 0.001913, 0.005298, 0.005366, 0.005355, 0.000682, 0.002593, 0.006843, 0.002589, -0.001954, -0.007333, -0.016584
#*# 	  0.068582, 0.062715, 0.067308, 0.062521, 0.051380, 0.045210, 0.034817, 0.031551, 0.030036, 0.034158, 0.029452, 0.019181, 0.024831, 0.019157, 0.018348, 0.018931, 0.018603, 0.018253, 0.013258, 0.016597, 0.021015, 0.017387, 0.012525, 0.004752, -0.001698
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 270.0
