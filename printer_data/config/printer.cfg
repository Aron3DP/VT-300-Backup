# THIS CONFIG IS FOR USE WITH Leviathan, Beacon & EBB36

# Required Configs, Always include these
[include mainsail.cfg]
[include macros/*.cfg]
[include timelapse.cfg]
[include K-ShakeTune/*.cfg]

#####################################################################
#   MCU / Leviathan / EBB36
#####################################################################

[mcu]
canbus_uuid: 96476c0cc178

[mcu EBB36]
canbus_uuid: d03347641955

[temperature_sensor Leviathan]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBB36
min_temp: 0
max_temp: 100

[temperature_sensor RPi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100


#####################################################################
#   Machine
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 5.0

[idle_timeout]
timeout: 1800


#####################################################################
#   X/Y Stepper Settings
#####################################################################

##  B Stepper - Left
##  Connected to HV STEPPER 0
[stepper_x]
step_pin: PB10
dir_pin: !PB11
enable_pin: !PG0
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_x:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_x]
cs_pin: PE15
spi_bus: spi4
diag0_pin: ^!PG1
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0

##  A Stepper - Right
##  Connected to HV STEPPER 1
[stepper_y]
step_pin: PF15
dir_pin: !PF14
enable_pin: !PE9
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc5160_stepper_y:virtual_endstop
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 40
homing_retract_dist: 0

[tmc5160 stepper_y]
cs_pin: PE11
spi_bus: spi4
diag0_pin: ^!PE10
driver_SGT: 0
interpolate: False
run_current: 1.0
sense_resistor: 0.075
stealthchop_threshold: 0


#####################################################################
#   Z Stepper Settings
#####################################################################

## Z0 Stepper - Front Left
##  Connected to STEPPER 0
[stepper_z]
step_pin: PD4
dir_pin: PD3
enable_pin: !PD7
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: probe:z_virtual_endstop
position_max: 290
position_min: -2.5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0


[tmc2209 stepper_z]
uart_pin: PD5
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z1 Stepper - Rear Center
##  Connected to STEPPER 1
[stepper_z1]
step_pin: PC12
dir_pin: PC11
enable_pin: !PD2
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: PD0
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

##  Z2 Stepper - Front Right
##  Connected to STEPPER 2
[stepper_z2]
step_pin: PC9
dir_pin: PC8
enable_pin: !PC10
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PA8
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBB36:PD0
dir_pin: !EBB36:PD1
enable_pin: !EBB36:PD2
rotation_distance: 22.50
gear_ratio: 50:8
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBB36:PB13
sensor_type: PT1000
pullup_resistor: 2200
sensor_pin: EBB36:PA3
min_temp: 10
max_temp: 350
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 500
max_extrude_cross_section: 5.0
pressure_advance: 0.02
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: EBB36:PA15
interpolate: false
run_current: 0.60
sense_resistor: 0.110
stealthchop_threshold: 0

[firmware_retraction]
retract_length: 0.5
retract_speed: 35
unretract_extra_length: 0.0
unretract_speed: 35


#####################################################################
#   ADXL / Input Shaper
#####################################################################

[resonance_tester]
accel_chip: beacon
accel_per_hz: 125
probe_points: 150, 150, 20

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 76.2
shaper_type_y = mzv
shaper_freq_y = 50.6


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PG11
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA1
pullup_resistor: 2200
max_power: 1
pwm_cycle_time: 0.0166
min_temp: 0
max_temp: 130


#####################################################################
#   Beacon
#####################################################################

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_2A25C8345154364134202020FF143F31-if00
x_offset: 0
y_offset: 22
mesh_main_direction: x
mesh_runs: 2


#####################################################################
#   Bed Mesh
#####################################################################

[bed_mesh]
speed: 450
mesh_min: 30,30
mesh_max: 270,270
probe_count: 25,25
algorithm: bicubic


#####################################################################
#   Z-Tilt
#####################################################################

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 12.5
   150, 252.5
   270, 12.5
speed: 450
retries: 10
retry_tolerance: 0.004
horizontal_move_z: 10


#####################################################################
#   Fan Control
#####################################################################

[fan]
pin: EBB36:PA0
kick_start_time: 0.5
off_below: 0.10

[heater_fan hotend_fan]
pin: EBB36:PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[controller_fan Controller_Fan]
pin: PF9
kick_start_time: 0.5
fan_speed: 0.50
idle_timeout: 1800


#####################################################################
# 	Chamber Thermistor
#####################################################################

[temperature_sensor Chamber]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA2
pullup_resistor: 2200
min_temp: 0
max_temp: 100
gcode_id: chamber_th


#####################################################################
# EXP1 / EXP2 (display) pins
#####################################################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PG9, EXP1_2=PG12,
    EXP1_3=PG13, EXP1_4=PG14,
    EXP1_5=PC13, EXP1_6=PC14,    # Slot in the socket on this side
    EXP1_7=PC15, EXP1_8=PF0,
    EXP1_9=<GND>, EXP1_10=<5V>,

    # EXP2 header
    EXP2_1=PA6, EXP2_2=PA5,
    EXP2_3=PE2, EXP2_4=PE4,
    EXP2_5=PE3, EXP2_6=PA7,      # Slot in the socket on this side
    EXP2_7=PE5, EXP2_8=<RST>,
    EXP2_9=<GND>, EXP2_10=PE4

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.518
#*# pid_ki = 1.267
#*# pid_kd = 83.098
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.636
#*# pid_ki = 4.376
#*# pid_kd = 246.136
#*#
#*# [beacon model default]
#*# model_coef = 1.4224131212906368,
#*# 	  1.760719564188449,
#*# 	  0.7911225972478116,
#*# 	  0.36898690428732855,
#*# 	  0.4102733854437782,
#*# 	  0.5147817459642499,
#*# 	  -0.2234086581135876,
#*# 	  -0.5490160428371165,
#*# 	  0.19906423572651866,
#*# 	  0.30632251599727406
#*# model_domain = 1.7921810629123274e-07,1.928696912017407e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 26.977205
#*# model_offset = 0.14600
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.038895, -0.026971, -0.021586, -0.021241, -0.021043, -0.008413, -0.008940, -0.004581, 0.005370, 0.014574, 0.014986, 0.011219, 0.015145, 0.016671, 0.021635, 0.021135, 0.019608, 0.008259, -0.000621, -0.010587, -0.019136, -0.018656, -0.004897, -0.017243, -0.041194
#*# 	  -0.038486, -0.031008, -0.026891, -0.026639, -0.022242, -0.014451, -0.015798, -0.011276, -0.002204, 0.009266, 0.008912, 0.009362, 0.010034, 0.013775, 0.011222, 0.015930, 0.013460, 0.005561, -0.006825, -0.016655, -0.023187, -0.017492, 0.001839, -0.009837, -0.038979
#*# 	  -0.043331, -0.035535, -0.035840, -0.032342, -0.029800, -0.024215, -0.025737, -0.022288, -0.010269, 0.006693, 0.002703, 0.000053, 0.006345, 0.007058, 0.004264, 0.006957, 0.002316, -0.005428, -0.016719, -0.024603, -0.030019, -0.025887, -0.006278, -0.019702, -0.048141
#*# 	  -0.052109, -0.045742, -0.040717, -0.037862, -0.039705, -0.033745, -0.036064, -0.034977, -0.022089, -0.007570, -0.001912, 0.001260, 0.004104, -0.000942, -0.009796, -0.009028, -0.009777, -0.019944, -0.028155, -0.033423, -0.037802, -0.034958, -0.027243, -0.039703, -0.065156
#*# 	  -0.053563, -0.047760, -0.044796, -0.044822, -0.041954, -0.036962, -0.040481, -0.035780, -0.026390, -0.008232, 0.014662, 0.029732, 0.029680, 0.008368, -0.012175, -0.014872, -0.018834, -0.024792, -0.030765, -0.033820, -0.035160, -0.037206, -0.038214, -0.052330, -0.076082
#*# 	  -0.058577, -0.051890, -0.052519, -0.048961, -0.042309, -0.035450, -0.038154, -0.038686, -0.024362, -0.002643, 0.033141, 0.045638, 0.048194, 0.024662, -0.009815, -0.019588, -0.021151, -0.025220, -0.030223, -0.032836, -0.035020, -0.033387, -0.040694, -0.052976, -0.081391
#*# 	  -0.058033, -0.051108, -0.046758, -0.047072, -0.039040, -0.030876, -0.033395, -0.034313, -0.022923, -0.004344, 0.030185, 0.042555, 0.044825, 0.022219, -0.006491, -0.009957, -0.017598, -0.022838, -0.028117, -0.028986, -0.029847, -0.030505, -0.040764, -0.053416, -0.076867
#*# 	  -0.056069, -0.049404, -0.047909, -0.045866, -0.036178, -0.028369, -0.029520, -0.035236, -0.023937, -0.015215, 0.003417, 0.010176, 0.014459, 0.001131, -0.011400, -0.011331, -0.017777, -0.022322, -0.026234, -0.028543, -0.032219, -0.032881, -0.041073, -0.052116, -0.075647
#*# 	  -0.047191, -0.044213, -0.042110, -0.041423, -0.031600, -0.024513, -0.027450, -0.028501, -0.023848, -0.017927, -0.012253, -0.011464, -0.005931, -0.005401, -0.007217, -0.006448, -0.013275, -0.017266, -0.021468, -0.022876, -0.028584, -0.035134, -0.041762, -0.052734, -0.069681
#*# 	  -0.047853, -0.045954, -0.041646, -0.039217, -0.032274, -0.028245, -0.031935, -0.033190, -0.027235, -0.021379, -0.012382, -0.013619, -0.008722, -0.006746, -0.007964, -0.002104, -0.012495, -0.018490, -0.023458, -0.024354, -0.029953, -0.035875, -0.040033, -0.050337, -0.065813
#*# 	  -0.045496, -0.043685, -0.042461, -0.038110, -0.033662, -0.030066, -0.034391, -0.036211, -0.024659, -0.017752, -0.010673, -0.014536, -0.006553, -0.005778, -0.007063, -0.006744, -0.012588, -0.017810, -0.023962, -0.026714, -0.031349, -0.032835, -0.040743, -0.049243, -0.065068
#*# 	  -0.038800, -0.039686, -0.037433, -0.035235, -0.027552, -0.028969, -0.033076, -0.033594, -0.025385, -0.015197, -0.007299, -0.007920, -0.003598, -0.004363, -0.010100, -0.007071, -0.014368, -0.015259, -0.023822, -0.024607, -0.029927, -0.035079, -0.037640, -0.046920, -0.060220
#*# 	  -0.027006, -0.025215, -0.025795, -0.020490, -0.019895, -0.017630, -0.022431, -0.020081, -0.012837, -0.005862, 0.003426, 0.001540, 0.004394, 0.003833, -0.000651, -0.000750, -0.005960, -0.012968, -0.016795, -0.018517, -0.023405, -0.029401, -0.034881, -0.040890, -0.055785
#*# 	  -0.015583, -0.019658, -0.020476, -0.017797, -0.014791, -0.011714, -0.015287, -0.012729, -0.003669, 0.005005, 0.008452, 0.006381, 0.009086, 0.007663, 0.003237, 0.002681, -0.004038, -0.007734, -0.013924, -0.014861, -0.020541, -0.026040, -0.028680, -0.037161, -0.051852
#*# 	  -0.020384, -0.025757, -0.024344, -0.021925, -0.019763, -0.011102, -0.015192, -0.011984, -0.004132, 0.003591, 0.008206, 0.004718, 0.006121, 0.005286, 0.002290, 0.000470, -0.004480, -0.011542, -0.015431, -0.016641, -0.023704, -0.029358, -0.033504, -0.040433, -0.055803
#*# 	  -0.038956, -0.036702, -0.035236, -0.031384, -0.025944, -0.020107, -0.021599, -0.019636, -0.012532, -0.005798, -0.002456, -0.005982, -0.004181, -0.004418, -0.008894, -0.008721, -0.014260, -0.019014, -0.023626, -0.025888, -0.033029, -0.040624, -0.043655, -0.051567, -0.068469
#*# 	  -0.050990, -0.047587, -0.043993, -0.039185, -0.033162, -0.025460, -0.027183, -0.024858, -0.018861, -0.012553, -0.012504, -0.015254, -0.013608, -0.015114, -0.018847, -0.017664, -0.022874, -0.027558, -0.031474, -0.032447, -0.041257, -0.047482, -0.053211, -0.060524, -0.076110
#*# 	  -0.056813, -0.053538, -0.050225, -0.045463, -0.038986, -0.032875, -0.035127, -0.032929, -0.027472, -0.026214, -0.023872, -0.027492, -0.024092, -0.024724, -0.027756, -0.026647, -0.030006, -0.035241, -0.039650, -0.040081, -0.046985, -0.054614, -0.060354, -0.069778, -0.085295
#*# 	  -0.058175, -0.054902, -0.051483, -0.046224, -0.040493, -0.034370, -0.037514, -0.037460, -0.032062, -0.030494, -0.029554, -0.033691, -0.030222, -0.029802, -0.032430, -0.031310, -0.036088, -0.041982, -0.046303, -0.047015, -0.054251, -0.060138, -0.067997, -0.076563, -0.091405
#*# 	  -0.056534, -0.055710, -0.051610, -0.049388, -0.043812, -0.039446, -0.043327, -0.044095, -0.038684, -0.037778, -0.035647, -0.040105, -0.038518, -0.038383, -0.040915, -0.039552, -0.045123, -0.049786, -0.054663, -0.056910, -0.062907, -0.070657, -0.076525, -0.085295, -0.102812
#*# 	  -0.061832, -0.061751, -0.059826, -0.055324, -0.050573, -0.047612, -0.051720, -0.053019, -0.047657, -0.044467, -0.043283, -0.047343, -0.046503, -0.049971, -0.053798, -0.052807, -0.057343, -0.062241, -0.067531, -0.069650, -0.076794, -0.086120, -0.091434, -0.098479, -0.115128
#*# 	  -0.063291, -0.064214, -0.062590, -0.059259, -0.055329, -0.054744, -0.061258, -0.061583, -0.055203, -0.050047, -0.048715, -0.053376, -0.052089, -0.055595, -0.061782, -0.061037, -0.067233, -0.072450, -0.077170, -0.080485, -0.087327, -0.095942, -0.101389, -0.109985, -0.125624
#*# 	  -0.056867, -0.057435, -0.056704, -0.056734, -0.054074, -0.053706, -0.061884, -0.064524, -0.055740, -0.048974, -0.047573, -0.055462, -0.052735, -0.054514, -0.058004, -0.058777, -0.067709, -0.074788, -0.079735, -0.083671, -0.090765, -0.099130, -0.104808, -0.111551, -0.128741
#*# 	  -0.044405, -0.048359, -0.051217, -0.051193, -0.050332, -0.050590, -0.058986, -0.062479, -0.052831, -0.044096, -0.046084, -0.054910, -0.051659, -0.052281, -0.055564, -0.055026, -0.066697, -0.075341, -0.081355, -0.086282, -0.093920, -0.103041, -0.107768, -0.114271, -0.129565
#*# 	  -0.021273, -0.028216, -0.035299, -0.037894, -0.037746, -0.037864, -0.046887, -0.049503, -0.039592, -0.032846, -0.036260, -0.046636, -0.044362, -0.044769, -0.047819, -0.047221, -0.056367, -0.065075, -0.074755, -0.079523, -0.089355, -0.101335, -0.103893, -0.110036, -0.122711
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 270.0
