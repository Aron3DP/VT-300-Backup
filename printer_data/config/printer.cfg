# THIS CONFIG IS FOR USE WITH Octopus 1.1, Beacon & EBB36

# Required Configs, Always include these
[include mainsail.cfg]
[include macros/*.cfg]
[include timelapse.cfg]
[include K-ShakeTune/*.cfg]

#####################################################################
#   MCU / Octopus / EBB36
#####################################################################

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32f446xx_25002D000150335331383520-if00
#serial: platform-fd500000.pcie-pci-0000:01:00.0-usb-0:1.3:1.0
restart_method: command

[mcu EBB36]
canbus_uuid: d03347641955

[temperature_sensor Octopus]
sensor_type: temperature_mcu
sensor_mcu: mcu
min_temp: 0
max_temp: 100

[temperature_sensor EBB36]
sensor_type: temperature_mcu
sensor_mcu: EBB36
min_temp: 0
max_temp: 100

[temperature_sensor RPi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100


#####################################################################
#   Machine
#####################################################################

[printer]
kinematics: corexy
max_velocity: 500  
max_accel: 10000
max_z_velocity: 15
max_z_accel: 350
square_corner_velocity: 5.0

[idle_timeout]
timeout: 1800


#####################################################################
#   X/Y Stepper Settings
#####################################################################

[stepper_x]
step_pin: PF13
dir_pin: PF12
enable_pin: !PF14
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: 0
position_endstop: 300
position_max: 300
homing_speed: 40
homing_retract_dist: 0

[tmc2209 stepper_x]
uart_pin: PC4
diag_pin: ^PG6
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 0
driver_SGTHRS: 140

[stepper_y]
step_pin: PG0
dir_pin: PG1
enable_pin: !PF15
rotation_distance: 40
microsteps: 32
full_steps_per_rotation: 400
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_min: 0
position_endstop: 307
position_max: 307
homing_speed: 40
homing_retract_dist: 0

[tmc2209 stepper_y]
uart_pin: PD11
diag_pin: ^PG9
interpolate: False
run_current: 1.0
sense_resistor: 0.110
stealthchop_threshold: 0
driver_SGTHRS: 140


#####################################################################
#   Z Stepper Settings
#####################################################################

[stepper_z]
step_pin: PF11
dir_pin: !PG3
enable_pin: !PG5
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200
endstop_pin: probe:z_virtual_endstop
position_max: 290
position_min: -2.5
homing_speed: 10
second_homing_speed: 3
homing_retract_dist: 0


[tmc2209 stepper_z]
uart_pin: PC6
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z1]
step_pin: PG4
dir_pin: !PC1
enable_pin: !PA0
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z1]
uart_pin: PC7
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0

[stepper_z2]
step_pin: PF9
dir_pin: !PF10
enable_pin: !PG2
rotation_distance: 4
microsteps: 32
full_steps_per_rotation: 200

[tmc2209 stepper_z2]
uart_pin: PF2
interpolate: False
run_current: 0.6
sense_resistor: 0.110
stealthchop_threshold: 0


#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: EBB36:PD0
dir_pin: !EBB36:PD1
enable_pin: !EBB36:PD2
rotation_distance: 22.50
gear_ratio: 50:8
microsteps: 16
full_steps_per_rotation: 200
nozzle_diameter: 0.400
filament_diameter: 1.75
heater_pin: EBB36:PB13
sensor_type: PT1000
pullup_resistor: 2200
sensor_pin: EBB36:PA3
min_temp: 10
max_temp: 350
max_power: 1.0
min_extrude_temp: 170
max_extrude_only_distance: 500
max_extrude_cross_section: 5.0
pressure_advance: 0.02
pressure_advance_smooth_time: 0.03

[tmc2209 extruder]
uart_pin: EBB36:PA15
interpolate: false
run_current: 0.60
sense_resistor: 0.110
stealthchop_threshold: 0

[firmware_retraction]
retract_length: 0.5
retract_speed: 35
unretract_extra_length: 0.0
unretract_speed: 35


#####################################################################
#   ADXL / Input Shaper
#####################################################################

[resonance_tester]
accel_chip: beacon
accel_per_hz: 100
probe_points: 150, 150, 20

[adxl345]
cs_pin: EBB36:PB12
spi_software_sclk_pin: EBB36:PB10
spi_software_mosi_pin: EBB36:PB11
spi_software_miso_pin: EBB36:PB2
axes_map: x,y,z

[input_shaper]
shaper_type_x = mzv
shaper_freq_x = 76.0
damping_ratio_x = 0.036
shaper_type_y = mzv
shaper_freq_y = 46.5
damping_ratio_y = 0.050


#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PA2
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF3
max_power: 1
pwm_cycle_time: 0.0166
min_temp: 0
max_temp: 120


#####################################################################
#   Beacon
#####################################################################

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevH_2A25C8345154364134202020FF143F31-if00
x_offset: 0
y_offset: 22
mesh_main_direction: x
mesh_runs: 2
contact_max_hotend_temperature: 270
home_xy_position: 150, 150
home_z_hop: 5
home_z_hop_speed: 30
home_xy_move_speed: 450
home_method: contact
home_method_when_homed: proximity
home_autocalibrate: unhomed
home_gcode_pre_x: _HOME_PRE_AXIS AXIS=X
home_gcode_post_x: _HOME_POST_AXIS AXIS=X
home_gcode_pre_y: _HOME_PRE_AXIS AXIS=Y
home_gcode_post_y: _HOME_POST_AXIS AXIS=Y
autocal_max_retries: 10


#####################################################################
#   Bed Mesh
#####################################################################

[bed_mesh]
speed: 450
mesh_min: 30,30
mesh_max: 270,270
probe_count: 25,25
algorithm: bicubic
zero_reference_position: 150, 150


#####################################################################
#   Z-Tilt
#####################################################################

[z_tilt]
z_positions:
   -50, 18
   150, 348
   350, 18
points:
   30, 8
   150, 258
   270, 8
speed: 450
retries: 10
retry_tolerance: 0.004
horizontal_move_z: 10


#####################################################################
#   Fan Control
#####################################################################

[fan]
pin: EBB36:PA0
kick_start_time: 0.5
off_below: 0.10

[heater_fan hotend_fan]
pin: EBB36:PA1
max_power: 1.0
kick_start_time: 0.5
heater: extruder
heater_temp: 50.0

[controller_fan Controller_Fan]
pin: PD12
kick_start_time: 0.5
fan_speed: 0.50
idle_timeout: 1800


#####################################################################
# 	Chamber Thermistor
#####################################################################

[temperature_sensor Chamber]
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PF5
min_temp: 0
max_temp: 100
gcode_id: chamber_th

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 20.606
#*# pid_ki = 1.164
#*# pid_kd = 91.181
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.636
#*# pid_ki = 4.376
#*# pid_kd = 246.136
#*#
#*# [beacon model default]
#*# model_coef = 1.4087552619713961,
#*# 	  1.729839188229793,
#*# 	  0.790246357342973,
#*# 	  0.4070734860603023,
#*# 	  0.29845234710684393,
#*# 	  0.2977897280943083,
#*# 	  0.01483845201817297,
#*# 	  -0.14351622324569543,
#*# 	  0.08744412927023429,
#*# 	  0.11105112334794492
#*# model_domain = 1.793422785697182e-07,1.9300276990758035e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 66.213316
#*# model_offset = 0.00000
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.007961, 0.000866, -0.004052, -0.017582, -0.031080, -0.032187, -0.012172, -0.009562, -0.027404, -0.028981, -0.020867, -0.010282, -0.016496, -0.020901, -0.018505, 0.007463, 0.011180, 0.001711, -0.008163, -0.000028, 0.010089, 0.003168, -0.000015, 0.010085, 0.004239
#*# 	  -0.007924, -0.007445, -0.025341, -0.032220, -0.031486, -0.025674, -0.022475, -0.032831, -0.031988, -0.025830, -0.018737, -0.025383, -0.029732, -0.019336, -0.008268, -0.004908, -0.013007, -0.012608, -0.006789, -0.003278, -0.003105, -0.009656, -0.000947, 0.010655, -0.001531
#*# 	  -0.014786, -0.028415, -0.032831, -0.030425, -0.034682, -0.042735, -0.049400, -0.038707, -0.029603, -0.036609, -0.044044, -0.044570, -0.021344, -0.017323, -0.023136, -0.028856, -0.026904, -0.009863, -0.010193, -0.021070, -0.028874, -0.017845, -0.005281, -0.015869, -0.019749
#*# 	  -0.024910, -0.031271, -0.036811, -0.038258, -0.042818, -0.056801, -0.056348, -0.046978, -0.040251, -0.038959, -0.049542, -0.048605, -0.033029, -0.027180, -0.032078, -0.035215, -0.026944, -0.022292, -0.023143, -0.035476, -0.035293, -0.029034, -0.020829, -0.021861, -0.023863
#*# 	  -0.026523, -0.029293, -0.040036, -0.050972, -0.049855, -0.045859, -0.051486, -0.057603, -0.056931, -0.042470, -0.041587, -0.047353, -0.052199, -0.049232, -0.030133, -0.029458, -0.034673, -0.041527, -0.033354, -0.029020, -0.034468, -0.037048, -0.033078, -0.020314, -0.022040
#*# 	  -0.031864, -0.042162, -0.038665, -0.048769, -0.056518, -0.053099, -0.049042, -0.047667, -0.059437, -0.057752, -0.050733, -0.046306, -0.050072, -0.052466, -0.041917, -0.034398, -0.030612, -0.038319, -0.037321, -0.035518, -0.029795, -0.027722, -0.029349, -0.022540, -0.020224
#*# 	  -0.031962, -0.043037, -0.040205, -0.044477, -0.055318, -0.057269, -0.052187, -0.046355, -0.053210, -0.059881, -0.058681, -0.047341, -0.047176, -0.049698, -0.051285, -0.040606, -0.029784, -0.034318, -0.039869, -0.040986, -0.029695, -0.027790, -0.028801, -0.024372, -0.022424
#*# 	  -0.025108, -0.031197, -0.043001, -0.041891, -0.040761, -0.042211, -0.050940, -0.052020, -0.049367, -0.048430, -0.048793, -0.056331, -0.053707, -0.048854, -0.038869, -0.039170, -0.039932, -0.035866, -0.030183, -0.032407, -0.037764, -0.035633, -0.028019, -0.024928, -0.024269
#*# 	  -0.016539, -0.022488, -0.034482, -0.035381, -0.034914, -0.040706, -0.044270, -0.045059, -0.041544, -0.043635, -0.047324, -0.049433, -0.048497, -0.035249, -0.029362, -0.036581, -0.034722, -0.029320, -0.024841, -0.029757, -0.032470, -0.029253, -0.018915, -0.020749, -0.021908
#*# 	  -0.010448, -0.021139, -0.027034, -0.027354, -0.037589, -0.044179, -0.040660, -0.038373, -0.040041, -0.049533, -0.046701, -0.040819, -0.032905, -0.029455, -0.032849, -0.030248, -0.019378, -0.018182, -0.021119, -0.026147, -0.021484, -0.018190, -0.016813, -0.022800, -0.021068
#*# 	  -0.003847, -0.013868, -0.022167, -0.032633, -0.038890, -0.034037, -0.035413, -0.037761, -0.044101, -0.041204, -0.031482, -0.029577, -0.030097, -0.030407, -0.021800, -0.015834, -0.017899, -0.021968, -0.021042, -0.012839, -0.012589, -0.014645, -0.018677, -0.015485, -0.017424
#*# 	  -0.002213, -0.005943, -0.013222, -0.026082, -0.031368, -0.029381, -0.031702, -0.035538, -0.032299, -0.027400, -0.021989, -0.017474, -0.019591, -0.019328, -0.012740, -0.008500, -0.010542, -0.012246, -0.010892, -0.005061, -0.004604, -0.007757, -0.006482, -0.004805, -0.009584
#*# 	  0.014313, 0.005175, 0.000049, -0.008389, -0.016795, -0.022138, -0.023613, -0.017263, -0.013526, -0.015006, -0.014162, -0.007993, 0.000000, -0.001545, -0.003434, -0.004615, 0.001447, 0.001678, 0.001594, -0.001619, -0.002606, 0.004370, 0.005359, -0.002479, -0.003476
#*# 	  0.021029, 0.010673, 0.001755, -0.006521, -0.011253, -0.017248, -0.020021, -0.018589, -0.012018, -0.009434, -0.009359, -0.005820, 0.001515, 0.006608, 0.007068, 0.002879, 0.002388, 0.006299, 0.008242, 0.004387, 0.000578, 0.001399, 0.002217, -0.000184, -0.002670
#*# 	  0.023919, 0.013379, 0.003520, -0.005672, -0.011251, -0.013599, -0.016726, -0.017898, -0.016709, -0.010384, -0.005819, -0.005937, -0.003002, 0.007638, 0.009942, 0.006277, 0.002528, 0.004334, 0.008991, 0.008362, 0.003624, 0.000470, 0.003098, 0.003499, -0.002234
#*# 	  0.025367, 0.013049, 0.007895, -0.001574, -0.009737, -0.014776, -0.014108, -0.013144, -0.012123, -0.013163, -0.008245, -0.002771, 0.001899, 0.003126, 0.006613, 0.008286, 0.009139, 0.010681, 0.008523, 0.006937, 0.007170, 0.006379, 0.004225, 0.001478, -0.001213
#*# 	  0.027136, 0.015118, 0.006798, -0.001630, -0.007596, -0.013141, -0.012685, -0.010175, -0.007866, -0.006736, -0.003850, 0.000048, 0.003007, 0.003104, 0.004558, 0.009971, 0.011868, 0.009789, 0.009550, 0.007192, 0.007761, 0.005734, 0.002220, -0.000994, -0.005469
#*# 	  0.018954, 0.007279, -0.001339, -0.009572, -0.013313, -0.016478, -0.017277, -0.012807, -0.007988, -0.006258, -0.004052, -0.003989, -0.001603, 0.000974, 0.002323, 0.004035, 0.006509, 0.007944, 0.007289, 0.005459, 0.003359, 0.001507, 0.000089, -0.004006, -0.009195
#*# 	  0.023909, 0.012180, 0.003693, -0.002170, -0.007096, -0.011508, -0.011168, -0.006782, -0.004198, -0.004257, -0.003422, -0.000769, 0.002806, 0.003357, 0.003446, 0.005037, 0.008433, 0.010603, 0.009779, 0.005101, 0.003685, 0.003905, 0.001355, -0.004337, -0.009369
#*# 	  0.030137, 0.019467, 0.010564, 0.004396, 0.001998, -0.003751, -0.003328, -0.001997, -0.000348, -0.000625, 0.000564, 0.003363, 0.005619, 0.004992, 0.005657, 0.008489, 0.010743, 0.011929, 0.010770, 0.007268, 0.006320, 0.005579, 0.003134, -0.002045, -0.006916
#*# 	  0.031002, 0.021720, 0.012470, 0.004341, 0.001812, -0.002551, -0.004208, -0.002375, -0.002484, -0.003126, -0.002269, -0.001480, -0.001504, -0.000559, 0.002208, 0.004906, 0.007732, 0.006585, 0.005411, 0.001555, -0.000502, -0.001433, -0.001968, -0.008294, -0.012766
#*# 	  0.027611, 0.016851, 0.008054, 0.000812, -0.003443, -0.007083, -0.009014, -0.006329, -0.003392, -0.004074, -0.006470, -0.007815, -0.006029, -0.004581, -0.001420, 0.001118, 0.002541, 0.002505, 0.002121, -0.000878, -0.002075, -0.002397, -0.006431, -0.011036, -0.015891
#*# 	  0.036769, 0.026459, 0.015495, 0.007142, 0.001032, -0.002418, -0.002854, -0.001687, -0.000242, -0.000672, -0.001560, -0.002349, -0.000383, 0.001253, 0.004602, 0.007404, 0.007765, 0.007950, 0.006979, 0.004469, 0.003284, 0.003356, -0.000318, -0.006345, -0.013093
#*# 	  0.050030, 0.038594, 0.028222, 0.019285, 0.012421, 0.007081, 0.006201, 0.006938, 0.009269, 0.008227, 0.006668, 0.007568, 0.008845, 0.010655, 0.013735, 0.015635, 0.015949, 0.015311, 0.014242, 0.013054, 0.011193, 0.010666, 0.007803, 0.001651, -0.006438
#*# 	  0.058806, 0.045092, 0.035372, 0.023829, 0.017738, 0.011629, 0.010920, 0.009002, 0.009336, 0.008981, 0.008835, 0.008542, 0.011876, 0.013279, 0.016394, 0.018699, 0.020036, 0.017842, 0.016960, 0.014374, 0.013478, 0.011939, 0.008520, 0.003199, -0.004091
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 30.0
#*# max_x = 270.0
#*# min_y = 30.0
#*# max_y = 270.0
